---
title: "BMI_final_project"
author: "Junting Ren Uni:jr3755"
date: "December 9, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
library(janitor)
library(psych)
```

##reading and cleaning the data
```{r reading and cleaning the data}
gh_project_raw <- read_excel("GHProject_Dataset.xlsx", sheet = 1) %>% 
  clean_names() %>% 
  mutate(mews = as.factor(mews), cindex = as.factor(cindex), 
         icu_flag = as.factor(icu_flag), gender = as.factor(gender), race =
           as.factor(race), religion = as.factor(religion), maritalstatus =
           as.factor(maritalstatus), insurancetype = as.factor(insurancetype)) 

gh_duplicate <- gh_project_raw[gh_project_raw$patientid %in% gh_project_raw$patientid[duplicated(gh_project_raw$patientid)],] %>% 
  group_by(patientid) %>% 
  count() 

##We got 69 patients with more than 1 visit, 68 had 2 visits, 1 had 3 visits.
dim(gh_duplicate)

gh_project <- gh_project_raw %>% 
  arrange(patientid, visitid) %>% 
  filter(!duplicated(patientid))

```

```{r descriptive statistics}
des_stat = gh_project %>%
  select(-gender, -race, -maritalstatus, -facilityname, -insurancetype, -facilityzip, -admitdtm, -religion, -postalcode, -is30dayreadmit, -patientid, -visitid -mews, -cindex, -icu_flag) %>%
  describe(na.rm = TRUE)
  
gender = table(gh_project$gender) %>% prop.table()
race = table(gh_project$race) %>% prop.table()
marital_status = table(gh_project$maritalstatus)  %>% prop.table()
insurance = table(gh_project$insurancetype) %>% prop.table()
religion = table(gh_project$religion) %>% prop.table()
readmit = table(gh_project$is30dayreadmit) %>% prop.table()
mews = table(gh_project$mews) %>% prop.table()
cindex = table(gh_project$cindex) %>% prop.table()
icu_flag = table(gh_project$icu_flag) %>% prop.table()
```

```{r recoding categorical var}
library(forcats)
gh_project$race = fct_collapse(gh_project$race, White = "White", Non_White = c("African Amer/Black","Asian","Native Amer/Alaskan","Natv Hawaii/Pacf Isl", "Other/Multiracial"))

gh_project$maritalstatus = fct_collapse(gh_project$maritalstatus, Married = "Married", Not_Married = c("Civil Union","Divorced","Separated","Single", "Widowed"))

gh_project$insurancetype = fct_collapse(gh_project$insurancetype, Private = "Private", Not_Private = c("Medicaid","Medicare"))

gh_project$religion = fct_collapse(gh_project$religion, Catholic = "Catholic", Christian = "Christian", Other = c("Angelican","Hebrew","Hindu","Islam", "Jewish", "Mormon", "No Affiliation", "Non Denominational", "Other"))

gh_project$insurancetype = fct_collapse(gh_project$insurancetype, Private = "Private", Not_Private = c("Medicaid","Medicare"))

gh_project$mews = fct_collapse(gh_project$mews, Normal = c("0", "1"), Increase_caution = c("2", "3"), Further_deterioration = c("4", "5"), Immediate_action_required = c("6", "7", "8", "9", "10", "11", "12", "14"))

gh_project$cindex = fct_collapse(gh_project$cindex, normal = "0", mild = c("1", "2"), moderate = "3", severe = "5")

gh_project = gh_project %>%
  filter(icu_flag == "0")
# model only applies to patients who did not go to ICU
```


```{r plots}
library(purrr)
library(tidyr)
library(ggplot2)

gh_project %>%
  keep(is.numeric) %>% 
  gather() %>% 
  ggplot(aes(value)) +
    facet_wrap(~ key, scales = "free") +
    geom_histogram()

attach(gh_project)

hist(losdays2)
hist(log(losdays2))

gh_project %>%
  keep(is.numeric) %>% 
  pairs(~ageyear+mews+evisit+cindex+bmi, data=.)

```

```{r transformations}
gh_project = 
  gh_project %>%
  mutate(log_losdays2 = log(losdays2))

#write dataset as csv
# write_csv(gh_project, path = "C:/Users/mphad/Documents/1st semester/Intro to Biostats/gh_project_data.csv")
```

```{r model selection}


```


```{r final model}



```



```{r model validation}


```



```{r check model assumption}



```


###Conclusion